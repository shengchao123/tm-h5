{"version":3,"sources":["webpack:///./src/pages/home/point-guide/index.vue?e28d","webpack:///./src/pages/home/point-guide/index.vue?aa0d","uni-app:///src/main.js","webpack:///./src/pages/home/point-guide/index.vue?e9be","webpack:///./src/pages/home/point-guide/index.vue?258f","webpack:///./src/pages/home/point-guide/index.vue?4868","webpack:///./src/pages/home/point-guide/index.vue?213f","uni-app:///src/pages/home/point-guide/index.vue","uni-app:///external \"AMap\""],"names":["createPage","Page"],"mappings":"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","file":"pages/home/point-guide/index.js","sourcesContent":["import mod from \"-!../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=66b320cb&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=66b320cb&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1621481950190\n      var cssReload = require(\"/Users/wdy/Documents/Project__slzx/business/external/tianmu-league/h5/node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  ","import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/home/point-guide/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=66b320cb&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=66b320cb&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"66b320cb\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/home/point-guide/index.vue\"\nexport default component.exports","export * from \"-!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--14-0!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=66b320cb&scoped=true&\"","var components\ntry {\n  components = {\n    uActionSheet: function() {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-action-sheet/u-action-sheet\" */ \"uview-ui/components/u-action-sheet/u-action-sheet.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\n  <div class='point-guide-wrap relative '>\n    <div id=\"map\"></div>\n    <PoiKeywords class=\"poi-keywords\"\n                 @changePois=\"changePois\"></PoiKeywords>\n    <DragPopover showLocation=\"true\"\n                 max-top=\"79.3\"\n                 @onLocation=\"onLocation\">\n      <div class=\"content-box\">\n        <PointGuideItem v-for=\"(item, index) in pois\"\n                        @onGuide=\"showGuideActionSheet\"\n                        @onPoi=\"onPoi\"\n                        :key=\"index\"\n                        :info=\"{item, index}\"\n                        :main=\"index === currentIndex\"></PointGuideItem>\n      </div>\n    </DragPopover>\n    <u-action-sheet :list=\"actions\"\n                    @click=\"onSelectGuide\"\n                    v-model=\"showGuide\"></u-action-sheet>\n  </div>\n</template>\n\n<script>\nimport mapMixin from '@/mixins/map.js'\nimport PoiKeywords from './components/PoiKeywords'\nimport AMap from 'AMap'\nimport DragPopover from '@/components/DragPopover'\nimport { subStringWithStrlen } from '@/utils/tools.js'\nimport Vue from 'vue'\nimport PointGuideItem from './components/PointGuideItem'\nimport { getAMapLngLat, getLngLat, beginGuide } from '@/utils/map.js'\n\n// 地图中心点上下纬度偏移量\nconst centerLngOffset = 0.04\n// 主要地标点\nlet scenicSpot = null\n\nconst LWH = { w: 38, h: 47 }\nconst MWH = { w: 25, h: 31 }\n\nexport default {\n  name: 'index',\n  methods: {\n    // 点击重新定位按钮\n    onLocation () {\n      this.setMapCenter(this.scenicSpot)\n    },\n    // 显示导航选择框\n    showGuideActionSheet (item) {\n      this.showGuide = true\n      this.guidePoint = item\n    },\n    // 选择地图导航回调\n    onSelectGuide (act, index) {\n      beginGuide(act, this.guidePoint)\n    },\n    // 选择切换 poi 点\n    onPoi (info) {\n      if (this.currentIndex === info.index) return\n      this.currentIndex = info.index\n      this.resetDrawMarkders(info.item)\n    },\n    // 兴趣点名字\n    changePois (poi) {\n      this.currentPoi = poi\n      this.currentIndex = 0\n      this.pois = [{ address: scenicSpot.regionsName, ...scenicSpot }]\n\n      this.$amap.clearMap()\n      this.setMapCenter(scenicSpot)\n      this.drawMarkder({ ...LWH }, scenicSpot)\n\n      if (poi.type) return this.getJourneyPointListByOrgId(poi.type)\n\n      this.getPoisWithLngLat(poi.name)\n    },\n    getJourneyPointListByOrgId (type) {\n      const params = { type }\n      this.$api.getJourneyPointListByOrgId(params).then(res => {\n        if (res.isError) return\n        const _pois = res.content.map(item => {\n          item.address = item.regionsName\n          return item\n        })\n        this.pois = [{ address: scenicSpot.regionsName, ...scenicSpot }].concat(_pois)\n        _pois.forEach(poi => {\n          this.drawMarkder({ ...MWH }, poi)\n        })\n      })\n    },\n    // 根据选择点，搜索 poi 点\n    getPoisWithLngLat () {\n      const that = this\n      AMap.plugin('AMap.PlaceSearch', function () {\n        var autoOptions = {\n          city: '杭州市',\n          pageSize: 50,\n          citylimit: true, // 是否强制限制在设置的城市内搜索\n          autoFitView: true // 是否自动调整地图视野使绘制的 Marker点都处于视口的可见范围\n        }\n        var placeSearch = new AMap.PlaceSearch(autoOptions)\n        placeSearch.searchNearBy(that.currentPoi.name, getAMapLngLat(scenicSpot), 5000, function (status, result) {\n          if (!result || !result.poiList) return\n          const _pois = result.poiList.pois\n          that.pois = [{ address: scenicSpot.regionsName, ...scenicSpot }].concat(_pois)\n          _pois.forEach(poi => {\n            that.drawMarkder({ ...MWH }, poi, that.currentPoi.marker)\n          })\n        })\n      })\n    },\n    // 点击显示信息框\n    markerClick (e) {\n      const _point = e.target.getExtData()\n      this.pois.forEach((item, index) => {\n        if (item.name === _point.name) this.currentIndex = index\n      })\n      this.resetDrawMarkders(_point)\n      this.showInfoWindow(e)\n    },\n    // 信息窗体\n    showInfoWindow (e) {\n      const marker = e.target\n      const _point = marker.getExtData()\n\n      const windowPosition = { ...marker.getPosition() }\n      const windowOffset = { ...marker.getOffset() }\n\n      windowOffset.y -= 20 // 在 marker 基础上获取偏移量上调\n      windowOffset.x = _point.address ? 3 : 5 // 根据是否有地址，判断是系统的 poi，还是地图搜索出来的，图标大小不同\n\n      const title = subStringWithStrlen(_point.name, 18)\n      const address = _point.address ? subStringWithStrlen(_point.address, 18) : _point.typeName\n\n      var _this = this\n      var MyComponent = Vue.extend({\n        template: \"<div class='map-info-wrap'>\" +\n          '<div>' +\n          `<div class='title'>${title}</div>` +\n          `<div class='address'>${address || ''}</div>` +\n          '</div>' +\n          '<div class=\"guide-btn center\" v-on:click=\"onOpenGuide\">' +\n          '<SvgIcon icon=\"icon_daohang\" style=\"color:#518CFC \"class=\"ft20 mr8\"></SvgIcon>' +\n          '<span>到这里去</span></div>' +\n          '</div>',\n        methods: {\n          onOpenGuide () {\n            _this.showGuideActionSheet(_point)\n          }\n        }\n      })\n      // 将新创建的子组件进行挂载\n      var component = new MyComponent().$mount()\n      console.log(component)\n      // 将窗体内容添加到infoWindow中\n      var infoWindow = new AMap.InfoWindow({\n        isCustom: true, // 使用自定义窗体\n        content: component.$el, // 传入 dom 对象，或者 html 字符串\n        offset: windowOffset,\n        autoMove: false\n      })\n      // 打开窗体\n      infoWindow.open(this.$amap, windowPosition)\n    },\n\n    // 绘制 marker\n    drawMarkder ({ w, h }, _spot, markerImg) {\n      const marker = new AMap.Marker({\n        position: getAMapLngLat(_spot),\n        map: this.$amap,\n        // animation: 'AMAP_ANIMATION_DROP',\n        offset: new AMap.Pixel(-w / 2, -h),\n        icon: this.getMarkderIcon(w, h, markerImg),\n        touchZoom: false\n      })\n\n      marker.setExtData(_spot)\n      // 点击方法绑定\n      marker.on('click', this.markerClick)\n\n      return marker\n    },\n\n    // 绘制坐标 icon\n    getMarkderIcon (w, h, markerImg = \"guide_mark_red.png\") {\n      return new AMap.Icon({\n        size: new AMap.Size(w, h),\n        image: require(`@/static/map/${markerImg}`),\n        imageSize: new AMap.Size(w, h)\n      })\n    },\n\n    // 绘制地图中心点\n    setMapCenter (_point) {\n      const { lng, lat } = getLngLat(_point)\n      const _lngLat = new AMap.LngLat(lng, lat - centerLngOffset)\n      this.$amap.setCenter(_lngLat)\n    },\n\n    // 重新绘制主要点和其它点位\n    resetDrawMarkders (_poi) {\n      this.$amap.clearMap()\n\n      let _pois = JSON.parse(JSON.stringify(this.pois))\n      _pois = _pois.filter((item, index) => index !== this.currentIndex)\n      _pois.forEach(poi => {\n        this.drawMarkder({ ...MWH }, poi, poi.typeName ? \"guide_mark_red.png\" : this.currentPoi.marker)\n      })\n\n      this.setMapCenter(_poi)\n      this.drawMarkder({ ...LWH }, _poi, _poi.typeName ? \"guide_mark_red.png\" : this.currentPoi.marker)\n    }\n  },\n  mounted () {\n    scenicSpot = JSON.parse(sessionStorage.getItem('pointData'))\n    this.pois = [{ address: scenicSpot.regionsName, ...scenicSpot }]\n    this.drawMarkder({ ...LWH }, scenicSpot)\n    this.setMapCenter(scenicSpot)\n  },\n  components: { PoiKeywords, DragPopover, PointGuideItem },\n  data () {\n    this.currentPoi = {}\n    return {\n      currentIndex: 0,\n      showGuide: false,\n      guidePoint: {},\n      actions: Object.freeze([{ text: '高德地图' }, { text: '腾讯地图' }]),\n      pois: [],\n      mapInitObj: Object.freeze({\n        resizeEnable: true,\n        zoom: 12\n      })\n    }\n  },\n  mixins: [mapMixin]\n}\n</script>\n\n<style lang='scss' scoped>\n.point-guide-wrap {\n  #map {\n    width: 100vw;\n    height: 93vh;\n  }\n\n  .poi-keywords {\n    position: absolute;\n    z-index: 98;\n    left: 12px;\n    top: 12px;\n  }\n  .content-box {\n    height: 100%;\n    overflow: scroll;\n  }\n}\n</style>\n","module.exports = AMap;"],"sourceRoot":""}