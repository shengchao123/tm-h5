{"version":3,"sources":["webpack:///./src/components/upload-images.vue?ae1d","webpack:///./src/components/upload-images.vue?51aa","webpack:///./src/components/upload-images.vue?9d53","webpack:///./src/components/upload-images.vue?751b","uni-app:///src/components/upload-images.vue","webpack:///./src/components/upload-images.vue?b3a9","webpack:///./src/components/upload-images.vue?34e4"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA0H;AAC1H;AACiE;AACL;AACc;;;AAG1E;AACgI;AAChI,gBAAgB,gJAAU;AAC1B,EAAE,mFAAM;AACR,EAAE,wFAAM;AACR,EAAE,iGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,4FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC1BA;AAAA;AAAA;AAAA;AAA2b,CAAgB,seAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;AC0B/c;;AACA;;;;;;;;;;gBACA;AACA;AACA;AACA,kBADA;AAEA,gBAFA,CAEA;;AAFA,KADA;AAKA;AACA,kBADA;AAEA,iBAFA,CAEA;;AAFA,KALA;AASA;AACA,iBADA;AAEA;AAAA;AAAA;AAFA,KATA;AAaA;AACA,kBADA;AAEA;AAFA;AAbA,GADA;AAmBA;AACA,aADA,uBACA;AACA;AACA,KAHA;AAIA,aAJA,uBAIA;AACA;AACA;AANA,GAnBA;AA2BA;AACA;AACA;AAAA;;AACA;AACA,wEADA;AACA;AACA,4CAFA;AAEA;AACA,uCAHA;AAGA;AACA;AACA;;AACA;AACA;AAPA;AASA,KAZA;AAaA;AACA,eAdA,uBAcA,MAdA,EAcA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AADA,mBAEA,oBAFA,EAEA,IAFA;;AAIA,0BALA,GAKA,EALA;AAMA;AACA,gCADA;AAEA;AAFA;AANA;AAAA;AAAA,uBAWA,6BAXA;;AAAA;AAWA,0BAXA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAaA;AACA;AACA,wCADA;AAEA;AAFA;AAdA;;AAAA;AAoBA;AACA;AACA,sGAFA,CAGA;;AACA;AACA;AACA,mBAFA,MAEA;AACA;;AACA;AACA;AACA,iBAVA,MAUA;AACA;AACA;;AACA;AACA;AACA,0CADA;AAEA,gCAFA;AAGA,8BAHA;AAIA;AAJA;AAMA,iBAxCA,CAyCA;;;AAzCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0CA,KAxDA;AAyDA,eAzDA,uBAyDA,IAzDA,EAyDA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AADA;AAGA;AACA,4DADA;AAEA;AACA,uBAHA;AAIA,wBAJA;AAKA,2BALA;AAMA,yBANA;AAOA,yBAPA;AAQA,4BARA;AASA,iBATA,mBASA,gBATA,EASA;AACA;;AACA;AACA;AACA,aAFA,MAEA;AACA;AACA;AACA,WAhBA;AAiBA,cAjBA,kBAiBA;AACA;AACA;AAnBA;AAqBA,OA7BA;AA+BA,KAzFA;AA0FA;AACA,YA3FA,oBA2FA,KA3FA,EA2FA;AACA;AACA;AACA,KA9FA;AA+FA;AACA,gBAhGA,wBAgGA,KAhGA,EAgGA;AAAA;;AACA;AACA;AACA;AACA,OAFA;AAGA;AACA,4BADA;AAEA,kBAFA;AAGA;AAHA;AAKA;AA1GA;AA3BA,C;;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAg3B,CAAgB,s3BAAG,EAAC,C;;;;;;;;;;;ACAp4B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/upload-images.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./upload-images.vue?vue&type=template&id=78a86ece&\"\nvar renderjs\nimport script from \"./upload-images.vue?vue&type=script&lang=js&\"\nexport * from \"./upload-images.vue?vue&type=script&lang=js&\"\nimport style0 from \"./upload-images.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/upload-images.vue\"\nexport default component.exports","export * from \"-!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--14-0!../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upload-images.vue?vue&type=template&id=78a86ece&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.imageList, function(item, index) {\n    var $orig = _vm.__get_orig(item)\n\n    var m0 = _vm.$sourceUrl(item.url)\n    return {\n      $orig: $orig,\n      m0: m0\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upload-images.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upload-images.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"flex flex-wrap upload-wrap\">\r\n    <view v-for=\"(item, index) in imageList\"\r\n          :key=\"index\"\r\n          class=\"upload-item column center\">\r\n      <image class=\"upload-img\"\r\n             :src=\"$sourceUrl(item.url)\"\r\n             mode=\"aspectFill\"\r\n             @click=\"previewImage(index)\"></image>\r\n      <text class=\"upload-del-btn\"\r\n            @click=\"delImage(index)\">\r\n        <svg-icon icon=\"icon_guanbi\"\r\n                  class=\"ft32 mb16\"></svg-icon>\r\n      </text>\r\n    </view>\r\n    <view v-if=\"rduLength > 0\"\r\n          class=\"upload-item border-ea color-999 column center\"\r\n          @click=\"chooseImage\">\r\n      <svg-icon icon=\"icon_xiangji\"\r\n                class=\"ft76 mb16\"></svg-icon>\r\n      <view class=\"ft28\">添加图片</view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { urls } from '@/api/urls.js'\r\nimport { getFullUrl } from '@/utils/tools.js'\r\nexport default {\r\n  props: {\r\n    count: {\r\n      type: Number,\r\n      default: 4 //单次可选择的图片数量\r\n    },\r\n    length: {\r\n      type: Number,\r\n      default: 50 //可上传总数量\r\n    },\r\n    imageData: {\r\n      type: Array,\r\n      default: () => { [] }\r\n    },\r\n    imageTypeName: {\r\n      type: String,\r\n      default: 'type'\r\n    }\r\n  },\r\n  computed: {\r\n    rduLength () {\r\n      return this.length - this.imageList.length;\r\n    },\r\n    imageList () {\r\n      return this.imageData\r\n    }\r\n  },\r\n  methods: {\r\n    //选择图片\r\n    chooseImage: function () {\r\n      uni.chooseImage({\r\n        count: this.rduLength < this.count ? this.rduLength : this.count, //最多可以选择的图片张数，默认9\r\n        sizeType: ['original', 'compressed'], //original 原图，compressed 压缩图，默认二者都有\r\n        sourceType: ['album', 'camera'], //album 从相册选图，camera 使用相机，默认二者都有\r\n        success: (res) => {\r\n          const images = res.tempFilePaths;\r\n          this.uploadFiles(images);\r\n        }\r\n      });\r\n    },\r\n    //上传图片\r\n    async uploadFiles (images) {\r\n      this.imageList.push({\r\n        url: images[0],\r\n        [this.imageTypeName]: '01'\r\n      });\r\n      let uploadData = \"\"\r\n      uni.showLoading({\r\n        title: '请稍后..',\r\n        mask: true,\r\n      })\r\n      try {\r\n        uploadData = await this.uploadImage(images[0]);\r\n      } catch (err) {\r\n        uni.hideLoading()\r\n        uni.showToast({\r\n          title: '系统连接超时，请稍后再试！',\r\n          mask: false\r\n        })\r\n        return;\r\n      }\r\n      if (uploadData.success) {\r\n        images.splice(0, 1);\r\n        this.imageList[this.imageList.length - 1].url = uploadData.content.filePaths[0];\r\n        //判断是否需要继续上传\r\n        if (images.length > 0 && this.rduLength > 0) {\r\n          this.uploadFiles(images);\r\n        } else {\r\n          uni.hideLoading();\r\n          this.$emit('update:imageData', this.imageList)\r\n        }\r\n      } else {\r\n        //上传失败处理\r\n        this.imageList.pop();\r\n        uni.hideLoading();\r\n        uni.showToast({\r\n          title: '上传中出现问题，已终止上传',\r\n          icon: 'none',\r\n          mask: true,\r\n          duration: 2000\r\n        });\r\n      }\r\n      // this.$emit('update:imageData', this.imageList)\r\n    },\r\n    uploadImage (file) {\r\n      return new Promise((resolve, reject) => {\r\n        //发送给后端的附加参数\r\n        const formData = {\r\n          type: 2,\r\n        };\r\n        const headers = {\r\n          'ContentType': 'multipart/form-data',\r\n        }\r\n        uni.uploadFile({\r\n          url: getFullUrl(urls.uploadFile),\r\n          // url: 'https://www.example.com/upload',\r\n          name: 'files',\r\n          filePath: file,\r\n          fileType: 'image',\r\n          timeout: 100000,\r\n          header: headers,\r\n          formData,\r\n          success (uploadFileResult) {\r\n            const uploadFileRes = JSON.parse(uploadFileResult.data) || {};\r\n            if (uploadFileRes.code === 10000 && uploadFileRes.content) {\r\n              resolve(uploadFileRes);\r\n            } else {\r\n              reject('接口返回错误');\r\n            }\r\n          },\r\n          fail () {\r\n            reject('网络链接错误');\r\n          }\r\n        });\r\n      });\r\n\r\n    },\r\n    //删除图片\r\n    delImage (index) {\r\n      this.imageList.splice(index, 1);\r\n      this.$emit('update:imageData', this.imageList)\r\n    },\r\n    //预览图片\r\n    previewImage (index) {\r\n      const urls = [];\r\n      this.imageList.forEach((item) => {\r\n        urls.push(this.$sourceUrl(item.url));\r\n      })\r\n      uni.previewImage({\r\n        current: urls[index],\r\n        urls: urls,\r\n        indicator: \"number\"\r\n      })\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.ft76 {\r\n  font-size: 76rpx;\r\n}\r\n.flex-wrap {\r\n  flex: wrap;\r\n}\r\n.border-ea {\r\n  border: 2rpx solid #eaeaea;\r\n}\r\n.upload-item {\r\n  position: relative;\r\n  width: 214rpx;\r\n  height: 214rpx;\r\n  border-radius: 10rpx;\r\n  margin-right: 24rpx;\r\n  margin-bottom: 24rpx;\r\n  box-sizing: border-box;\r\n  .upload-img {\r\n    width: 100%;\r\n    height: 100%;\r\n    border-radius: 10rpx;\r\n  }\r\n  .upload-del-btn {\r\n    position: absolute;\r\n    right: -16rpx;\r\n    top: -16rpx;\r\n    width: 32rpx;\r\n    height: 32rpx;\r\n    color: #c7c7c7;\r\n    background: #ffffff;\r\n    border-radius: 100%;\r\n  }\r\n}\r\n.upload-wrap .upload-item:nth-of-type(3n) {\r\n  margin-right: 0;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upload-images.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upload-images.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1625538128273\n      var cssReload = require(\"D:/word/project/business-projects/external/tianmu-league/h5/node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}